<%- include("../layouts/header") %>
<%- include("../layouts/sidebar") %>

<div class="content-body">
  <div class="container-fluid">
    <div class="row page-titles">
      <div class="col p-md-0">
        <h3>Ratings & Reviews</h3>
      </div>
    </div>

    <% if (success) { %>
      <div class="alert alert-success alert-dismissible fade show">
        <%= success %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <% if (error) { %>
      <div class="alert alert-danger alert-dismissible fade show">
        <%= error %>
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      </div>
    <% } %>

    <div class="mb-3">
      <a href="/admin/ratings/add" class="btn btn-primary">
        <i class="fa fa-plus"></i> Add New Rating
      </a>
    </div>

    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-striped table-hover">
            <thead class="table-dark">
              <tr>
                <th>#</th>
                <th>Image</th>
                <th>Name</th>
                <th>Email</th>
                <th>Rating</th>
                <th>Message</th>
                <th>Date</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody>
              <% if (ratings && ratings.length > 0) { %>
                <% ratings.forEach((r, i) => { %>
                  <tr>
                    <td><%= i + 1 %></td>
                    <td>
                      <% if (r.image) { %>
                        <img 
                          src="/uploads/<%= r.image %>" 
                          alt="<%= r.name %>" 
                          class="rounded" 
                          width="60" 
                          height="60" 
                          style="object-fit: cover;"
                        >
                      <% } else { %>
                        <span class="text-muted">No image</span>
                      <% } %>
                    </td>
                    <td><strong><%= r.name %></strong></td>
                    <td><%= r.email %></td>
                    <td>
                      <% for(let star = 1; star <= 5; star++) { %>
                        <i class="fas fa-star <%= star <= r.rating ? 'text-warning' : 'text-muted' %>"></i>
                      <% } %>
                      <span class="ms-1">(<%= r.rating %>)</span>
                    </td>
                    <td>
                      <%= r.message ? r.message.substring(0, 80) + (r.message.length > 80 ? '...' : '') : '-' %>
                    </td>
                    <td>
                      <%= new Date(r.createdAt).toLocaleDateString('en-US', { 
                          year: 'numeric', 
                          month: 'short', 
                          day: 'numeric' 
                      }) %>
                    </td>
                    <td>
                      <a href="/admin/ratings/edit/<%= r.id %>" class="btn btn-sm btn-info text-white">
                        <i class="fa fa-edit"></i> Edit
                      </a>
                      <a href="/admin/ratings/delete/<%= r.id %>" 
                         class="btn btn-sm btn-danger"
                         onclick="return confirm('Are you sure you want to delete this rating?')">
                        <i class="fa fa-trash"></i> Delete
                      </a>
                    </td>
                  </tr>
                <% }) %>
              <% } else { %>
                <tr>
                  <td colspan="8" class="text-center text-muted py-4">
                    No ratings found.
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<%- include("../layouts/footer") %>